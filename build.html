<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>biuld</title>
  <link rel="icon" type="image/png" href="images/favicon.png" />
  <link href="css/style.css" rel="stylesheet" />
  <link href="css/build.css" rel="stylesheet" />
  <script type="text/javascript" src="js/main.js"></script>
</head>
<body>
  <div class="menu">
    <svg xmlns="http://www.w3.org/2000/svg" width="62" height="35" viewBox="0 0 62 35" fill="none">
    <path d="M0 35V0H26.4792L62 35H0Z" fill="#FFFFFF"/>
    </svg>
    <img src="" alt="">
    <a class="" href="index.html">
      <h1>projects</h1>
    </a>
    <a class="" href="events.html">
      <h1>events</h1>
    </a>
    <a class="" href="book.html">
      <h1>book</h1>
    </a>
    <a class="" href="shop.html">
      <h1>shop</h1>
    </a>
    <a class="" href="closer.html">
      <h1>come closer</h1>
    </a>
    <a class="" href="build.html">
      <h1>build game</h1>
    </a>
  </div>

  <img class="home" src="house_button.svg">
  <div class="overlay">
    <div>
      <p></p>
      <img src="continue.svg">
    </div>
  </div>
  <div class="building">
    <h1 class="score">YOUR SCORE: 0</h1>
    <canvas id="buildGame" width="800" height="600" style='background: #101027; font-family: "TTNormsProEduNormal"'></canvas>
    <div class="gameover">
      <svg class="background" preserveAspectRatio="none" viewBox="0 0 1438 1091" fill="none"
        xmlns="http://www.w3.org/2000/svg">
        <path d="M-1 379.369L564 0H1438L893 205.47L1438 1086.49L976.5 894.548L161.5 1092L-1 379.369Z" fill="#AED9F4" />
      </svg>
      <div class="text">
        <h1>game over:(</h1>
        <p>but itâ€™s okay! click to start again</p>
      </div>
    </div>
  </div>
  <div class="digging">
    <div class="blocks">
      <div id="a" class="row">
        <div class="text-block">
          <p>dig</p>
        </div>
        <div class="block"></div>
      </div>
      <div id="b" class="row">
        <div class="block"></div>
        <div class="text-block">
          <p>to find</p>
        </div>
      </div>
      <div id="c" class="row">
        <div class="text-block">
          <p>remains</p>
        </div>
        <div class="block"></div>
      </div>
      <div id="d" class="row">
        <div class="block"></div>
      </div>
      <div id="e" class="row">
        <div class="block"></div>
      </div>
      <div id="f" class="row">
        <div class="block"></div>
      </div>
    </div>
    <img id="a" class="figure" src="shape1.svg" alt="">
    <img id="b" class="figure" src="shape2.svg" alt="">
    <img id="c" class="figure" src="shape3.svg" alt="">
    <img id="d" class="figure" src="shape4.svg" alt="">
    <img id="e" class="figure" src="shape5.svg" alt="">
    <img id="f" class="figure" src="shape6.svg" alt="">
    <img id="g" class="figure" src="shape7.svg" alt="">
    <img id="h" class="figure" src="shape8.svg" alt="">
    <img id="i" class="figure" src="shape9.svg" alt="">
    <svg class="background" preserveAspectRatio="none" viewBox="0 0 1438 1091" fill="none"
      xmlns="http://www.w3.org/2000/svg">
      <path d="M-1 379.369L564 0H1438L893 205.47L1438 1086.49L976.5 894.548L161.5 1092L-1 379.369Z" fill="#ffffff" />
    </svg>
  </div>
  <div class="start">
    <div class="l">
      <img src="shovel.svg">
      <div class="u">
        <p>digging</p>
      </div>
      <div class="d"></div>
    </div>
    <div class="r">
      <img src="house.svg">
      <div class="u">
        <p>building</p>
      </div>
      <div class="d"></div>
    </div>
  </div>
  <canvas id="buildGame"  height="800px">


  <script type="text/javascript">

  window.addEventListener('load', () => {
let clicked = 0
let overlayTo = 0
let body = document.querySelector('body')
let diggingButton = document.querySelector('body > div.start > div.l')
let buildingButton = document.querySelector('body > div.start > div.r')
let overlayText = document.querySelector('.overlay p')
let rows = document.querySelectorAll('div.row')
let overlay = document.querySelector('.overlay')
let start = document.querySelector('.start')
let digging = document.querySelector('.digging')
let building = document.querySelector('.building')
let gameover = document.querySelector('.gameover')
let score = document.querySelector('.score')
let canvas = document.getElementById("buildGame");
let home = document.querySelector('.home')

diggingButton.addEventListener('click', () => {
  display(1)
})
buildingButton.addEventListener('click', () => {
  display(2)
})
overlay.addEventListener('click', () => {
  display(overlayTo)
  makeOverlay(false)
})
gameover.addEventListener('click', () => {
  restart();
  gameover.style['display'] = 'none';
})
home.addEventListener('click', () => {
  display(0)
})

function display(index) {
  switch (index) {
    case 0:
      start.style['display'] = 'flex'
      digging.style['display'] = 'none'
      building.style['display'] = 'none'
      home.style['display'] = 'none'
      break
    case 1:
      start.style['display'] = 'none'
      digging.style['display'] = 'flex'
      building.style['display'] = 'none'
      home.style['display'] = 'initial'
      break
    case 2:
      start.style['display'] = 'none'
      digging.style['display'] = 'none'
      building.style['display'] = 'flex'
      home.style['display'] = 'initial'
      break
  }
}
if(display(0)){
  building.style['display'] = 'none'
}
function makeOverlay(shown, text = '', to = 0) {
  overlay.style['display'] = shown ? 'initial' : 'none'
  body.style['background-color'] = shown ? '#fff' : '#101027'
  overlayText.innerText = text;
  overlayTo = to
}

for (let i = rows.length - 1; i >= 0; i--) {
  rows[i].addEventListener('click', () => {
    let row = rows[i]
    if (row.style['opacity'] != '0') {
      clicked++
    }
    if (clicked >= 6) {
      makeOverlay(true, 'go build', 2)
    }
    row.style['opacity'] = '0%'
  })
}

addEventListener("resize", () => {
  canvas.width = innerWidth;
  canvas.height = innerHeight;
})
canvas.width = innerWidth;
canvas.height = innerHeight;
let context = canvas.getContext("2d");
let scrollCounter, cameraY, current, mode, xSpeed;
let ySpeed = 10;
let height = 200;
let boxes = [];
let figure = ["fugure_1.svg", "fugure_2.svg", "fugure_3.svg", "fugure_4.svg", "fugure_5.svg"]
function getImage(url) {
  const image = new Image(url)
  image.src = url
  return image;
}
boxes[0] = {
  x: (canvas.width - 120) / 2,
  y: 20,
  width: 231,
  image: getImage(figure[0])
};
function newBox() {
  const img = new Image()
  img.src = figure[Math.floor(Math.random() * figure.length)]
  boxes[current] = {
    x: 270,
    y: (current + 1) * height,
    width: 231,
    image: img
  };
}
function gameOver() {
  mode = 'gameOver';
  gameover.style['display'] = 'initial';
}

function animate() {
  if (mode != 'gameOver') {
    context.clearRect(0, 0, canvas.width, canvas.height);
    for (let n = 0; n < boxes.length; n++) {
      let box = boxes[n];
      context.drawImage(box.image, box.x, 600 - box.y + cameraY, box.width, height);
    }
    if (mode == 'bounce') {
      boxes[current].x = boxes[current].x + xSpeed;
      if (xSpeed > 0 && boxes[current].x + boxes[current].width > canvas.width)
        xSpeed = -xSpeed;
      if (xSpeed < 0 && boxes[current].x < 0)
        xSpeed = -xSpeed;
    }
    if (mode == 'fall') {
      boxes[current].y = boxes[current].y - ySpeed;
      if (boxes[current].y == boxes[current - 1].y + height) {
        mode = 'bounce';
        let difference = boxes[current].x - boxes[current - 1].x;
        if (Math.abs(difference) >= boxes[current].width) {
          gameOver();
        }
        if (xSpeed > 0) {
          xSpeed += 2;
        }
        current++;
        scrollCounter = height;
        newBox();
        score.innerText = `YOUR SCORE: ${current - 1}`
      }
    }
    if (scrollCounter) {
      cameraY += 2;
      scrollCounter -= 2;
    }
    context.fillStyle = '#101027';
  }
  window.requestAnimationFrame(animate);
}

function restart() {
  mode = 'bounce';
  boxes = [boxes[0]]
  cameraY = 12;
  scrollCounter = 0;
  xSpeed = 10;
  current = 1;
  newBox();

}
canvas.onpointerdown = function () {
  if (mode == 'bounce') {
    mode = 'fall';
  }
}
restart();
animate();
})
  </script>
</body>
